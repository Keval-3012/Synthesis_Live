@model EntityModels.Models.Invoice
@using Utility
@using Syncfusion.EJ2
<link href="~/Content/ej2/bootstrap5.css" rel="stylesheet" />
@{ SynthesisQBOnline.BAL.QBResponse qBResponse = new SynthesisQBOnline.BAL.QBResponse(); }
<style>
    .loading-containers {
        z-index: 200000;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,.8)url('../../Content/Admin/images/white_trans.png') repeat left top !important;
    }

        .loading-containers .loaders {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            -webkit-animation: typing 1s linear infinite alternate;
            -moz-animation: Typing 1s linear infinite alternate;
            animation: typing 1s linear infinite alternate;
            margin: 50vh auto;
            position: relative;
            left: -12px;
        }

    .bothActive {
        display: flex;
        width: 14px;
        height: 14px;
        background: #57f257;
        margin: 3px 5px 0px 5px;
        border-radius: 8px;
        border: 2px solid green;
    }

    .synthesisOnlyActive {
        display: flex;
        width: 14px;
        height: 14px;
        background: #cef257;
        margin: 3px 5px 0px 5px;
        border-radius: 8px;
        border: 2px solid #e9745f;
    }
</style>
<style>
    .InvoiceTool {
        cursor: pointer;
        color: #0c9dcc;
        font-weight: 600;
        background: rgba(0,0,0,0.1);
        height: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 5px 10px;
        border-radius: 10px;
    }

    a:focus, a:hover {
        border-bottom: 3px solid #e53939;
        color: #e53939;
        text-decoration: none;
    }

    .Tab {
        border-bottom: 3px solid #e53939;
        color: #e53939;
    }
</style>
<style>
    .below-95 {
        border: 1px solid #F28705 !important;
        color: #F28705 !important;
    }

    .below-85 {
        border: 1px solid #F23030 !important;
        color: #F23030 !important;
    }

    .above-95 {
        border-bottom: 2px solid #09aadc !important;
    }
</style>
<div class="animate-panelmessesgarea padbtmzero">

    @if (Convert.ToString(ViewBag.StatusMessage) == "Success")
    {
        <script>
            MyfunSuccess();
        </script>
    }

    @if (Convert.ToString(ViewBag.StatusMessage) == "Delete")
    {
        <script>
            MyfunSuccess();
        </script>
    }
    @if (Convert.ToString(ViewBag.StatusMessage) == "Error")
    {
        <script>
            MyfunError();
        </script>
    }
    @if (Convert.ToString(ViewBag.StatusMessage) == "NoItem")
    {
        <script>
            MyfunNoItem();
        </script>
    }
    @if (Convert.ToString(ViewBag.StatusMessage) == "Exists")
    {
        <script>
            showpopupEdit();
        </script>
    }
</div>

<div class="loading-containers loading-inactives" style="display:none;">
    <div class="loaders"></div>
</div>
@using (Html.BeginForm("Edit", "Invoices", FormMethod.Post, new { enctype = "multipart/form-data", id = "frm1" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    @Html.HiddenFor(x => x.IsActive)
    @Html.HiddenFor(x => x.IsSync)
    @Html.HiddenFor(x => x.QBTransfer)
    @Html.HiddenFor(x => x.SyncDate)
    @Html.HiddenFor(x => x.Source)
    @Html.HiddenFor(x => x.TXNId)
    @Html.HiddenFor(a => a.FromInvoicePage)
    @Html.HiddenFor(a => a.InvoiceReview)
    @Html.HiddenFor(model => model.InvoiceId)
    <div class="page-body headertopbox addinvoice" style="padding-top:0px!important;">
        <div class="header-small header_invoicedetail marleftzero">
            <input type="hidden" id="CurrentDate" value="@ViewBag.CurrentDate" />
            <div class="row">
                <div class="col-md-5 col-sm-12">
                    <h3>Invoice# <span>@Html.DisplayFor(m => m.InvoiceNumber)</span> </h3>
                </div>
                <div class="col-md-7 col-sm-12">
                    <div class="invoicedetail_text">
                        <ul>
                            @{
                                <li>
                                    <span class="ttl1">Created By</span> <span class="namebox">@Model.CreatedByUserName</span> <span class="datebox">
                                        @AdminSiteConfiguration.GetDatestatusmsg(Convert.ToString(Model.CreatedOn))
                                    </span>
                                </li>
                                if (Model.ModifiedBy != null)
                                {
                                    <li>
                                        <span class="ttl1">Modified By</span> <span class="namebox">@Model.ModifiedByUserName</span> <span class="datebox">
                                            @AdminSiteConfiguration.GetDatestatusmsg(Convert.ToString(Model.ModifiedOn))
                                        </span>
                                    </li>
                                }

                                <li>
                                    @{ if (Model.StatusValue == EntityModels.Models.InvoiceStatusEnm.Approved)
                                        {
                                            <span class="ttl1">Approved By</span> <span class="namebox">@Model.ApproveRejectUserName</span> @*<span class="namebox">@Model.ApproveRejectBy</span>*@
                                            @AdminSiteConfiguration.GetDatestatusmsg(Convert.ToString(Model.ApproveRejectDate)) }
                                        else if (Model.StatusValue == EntityModels.Models.InvoiceStatusEnm.Rejected)
                                        {
                                            <span class="ttl1">Rejected By</span>
                                            <span class="namebox">@Model.ApproveRejectUserName</span>
                                            @AdminSiteConfiguration.GetDatestatusmsg(Convert.ToString(Model.ApproveRejectDate)) }
                                        else
                                        {<span class="ttl1">Approved By</span>
                                            <span class="namebox">Not Approved Yet</span> } }
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="page-body headertopbox addinvoice" id="pdfSection" style="padding-top:0px!important;">
            <div class="">
                <div class="col-md-6 col-sm-6 leftpart">
                    <div>
                        <div class="input_edite uplaodpdfbox">
                            @Html.TextBoxFor(model => model.UploadInvoice, new { type = "file" })
                            @Html.HiddenFor(s => s.UploadInvoice)
                            <div data-provides="fileupload">
                                <span id="spaninvoice">
                                </span>
                            </div>
                            <div class="clear"></div>
                        </div><div class="clear"></div>
                        <div class="invoiceimage min_height10"></div>
                    </div>

                    <div class="pdf_popup_area">
                        @if (!string.IsNullOrEmpty(Model.UploadInvoice))
                        {
                            <iframe src="~/UserFiles/Invoices/@Model.UploadInvoice" frameborder="0" width="100%" height="1000" id="ifrm"></iframe>
                        }
                    </div>

                    <div class="clear"></div>
                    <div id="popupStoreid" class="divIDClass modal-popup modal-danger modal-message " style="position: fixed;  left:45%; width:300px; top: 10px; display:none">
                        <div class="modal-content ">
                            <div class="modal-header text-center">
                                <i class="glyphicon glyphicon-fire"></i>
                            </div>
                            <div class="modal-title">Invoice</div>
                            <div class="modal-body ">Please select the store for add Invoice.</div>
                            <div class="modal-footer " style="text-align:center">
                                <a class="btn" data-dismiss="modal" onclick="closemodal()">OK</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-sm-6 rightpart">
                    <div style="display: flex;justify-content: space-between;align-items: center;">
                        <h3>
                            <a href="#" id="InvoiceInformation" class="Tab" onclick="InvoiceInformation();">Invoice Information</a>
                        </h3>
                        <h3 style="margin-right: auto; margin-left: 25px;">
                            <a href="#" id="LineItems" onclick="LineItem();">Line Items</a>

                        </h3>
                        <span id="divBack"></span>
                    </div>
                    <div id="1" class="formmain">
                        @Html.HiddenFor(model => model.StatusValue)
                        @Html.HiddenFor(model => model.QBTransfer)
                        @Html.HiddenFor(model => model.CreatedBy)
                        @Html.HiddenFor(model => model.CreatedOn)
                        @Html.HiddenFor(model => model.ApproveRejectBy)
                        @Html.HiddenFor(model => model.ApproveRejectDate)
                        @Html.HiddenFor(model => model.StoreId)
                        @{
                            if (Roles.IsUserInRole("Administrator"))
                            {
                                <div class="row">
                                    <div class="col-md-6 col-sm-6">
                                        <div class="form-group">
                                            <label>Store Name</label><br />

                                            <span style="font-size:17px;color: #000;font-weight: 500;">
                                                @Html.DisplayFor(m => m.StoreName)
                                            </span>

                                        </div>
                                    </div>
                                </div>
                            }
                        }

                        <div class="row">
                            <div class="col-md-6 col-sm-6">
                                <div class="form-group">
                                    <label>Select Payment Method</label> <span class="highlight">*</span><br />
                                    @Html.HiddenFor(model => model.StoreName)

                                    @Html.DropDownList("PaymentTypeId", null, new { id = "Payment_type", @class = "form-control", maxlength = 100, onchange = "ddListPaymentTypeChange(this.value)" })
                                    @Html.ValidationMessageFor(model => model.PaymentTypeId)
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6">
                                <div class="form-group">
                                    <label>Invoice Type </label><span class="highlight">*</span>
                                    @Html.DropDownList("InvoiceTypeId", null, new { id = "Type_id", @class = "form-control", onchange = "ddLTypeChange(this.value)" })
                                    @Html.ValidationMessageFor(model => model.InvoiceTypeId)
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-sm-6">
                                <div class="form-group">
                                    <div style="display: flex;flex-direction: row;justify-content: space-between;" id="ToolTipInstuctions"><label>Vendor Name</label><span class="highlight" style="margin-right: auto;">*</span><span class="" id="spnActive"></span><span class="InvoiceTool">Instructions</span></div>
                                    @Html.DropDownList("VendorId", null, "Select Vendor ", new { @class = "myval", @onchange = "BindAddress(this.value);" })
                                    @Html.ValidationMessageFor(model => model.VendorId)
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6" id="divvendorphone">
                                <div class="form-group">
                                    <label>Vendor Phone Number</label>
                                    <br /><br />
                                    <div class="addressbox" id="PhoneNumber">
                                        @Html.DisplayFor(model => model.VendorMasters.PhoneNumber)
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="divvendoraddress">
                            <div class="col-md-12 col-sm-12">
                                <div class="form-group">
                                    <label>Vendor Address</label>
                                    <div class="addressbox" id="addresss">
                                        @Html.DisplayFor(model => model.VendorMasters.Address)
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-sm-6">
                                <div class="form-group">
                                    <label>Invoice #</label><span class="highlight">*</span>
                                    @Html.TextBoxFor(model => model.InvoiceNumber, new { maxlength = 35, id = "Invoice_Number", name = "Invoice_Number", Type = "text", @class = "form-control required" })
                                    <span class="highlight">     @Html.ValidationMessageFor(model => model.InvoiceNumber)</span>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6">
                                <div class="form-group">
                                    <label>Invoice Date</label><span class="highlight">*</span>
                                    @{
                                        if (Model.strInvoiceDate.ToString().Contains("2023"))
                                        {
                                            <div class="">
                                                @Html.HiddenFor(model => model.TotalAmount)
                                                @Html.HiddenFor(model => model.strInvoiceDate)
                                                @Html.TextBoxFor(model => model.strInvoiceDate, new { onkeydown = "return false", maxlength = 100, @class = "datepicker form-control ", @id = "InvoiceDate", disabled = "disabled" })
                                                @Html.ValidationMessageFor(model => model.strInvoiceDate)
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="">
                                                @Html.HiddenFor(model => model.TotalAmount)
                                                @Html.TextBoxFor(model => model.strInvoiceDate, new { onkeydown = "return false", maxlength = 100, @class = "datepicker form-control ", @id = "InvoiceDate" })
                                                @Html.ValidationMessageFor(model => model.strInvoiceDate)
                                            </div>
                                        }
                                    }

                                </div>
                            </div>
                        </div>
                        <div class="whitebox">
                            <div class="row">
                                <div class="col-md-12">
                                    <label>Invoice Breakdown<span class="highlight">*</span> </label>
                                </div>
                            </div>
                            <div id="tbladdon" class="tbladdoncls">

                                @{
                                    var k = 0;
                                    var temp = "";
                                    for (var j = 0; j < Model.InvoiceDepartmentDetails.Count; j++)
                                    {
                                        k = (j + 1);
                                        <input type="hidden" id="hdninvoicecount" value='@Model.InvoiceDepartmentDetails.Count' />
                                        <input type="hidden" id="hdnreqval" value="0" />
                                        <div id="trrow_@k" class="trrowcls">
                                            <div class="row">
                                                <div class="col-lg-7 col-md-5 col-sm-5 jquerydiv">
                                                    <div class="form-group">
                                                        @{
                                                            @Html.DropDownList("ChildDepartmentId", new SelectList(Model.DepartmentMasters, "DepartmentId", "DepartmentName", Model.InvoiceDepartmentDetails[j].DepartmentId), "Select Department", new { @class = "form-control drpcls wdith255 myval", id = "Drp_" + k })
                                                        }
                                                    </div>
                                                </div>
                                                <div class="col-md-1 col-sm-1 col-xs-1 visible-xs visible-sm visible-md">
                                                    <span class="spncredit" style="color:red;display:none;"> - </span>
                                                </div>
                                                <div class="col-lg-3 col-md-3 col-sm-3 padleftzero padrightzero">
                                                    <div class="form-group">
                                                        @Html.TextBox("ChildAmount", (decimal)Model.InvoiceDepartmentDetails[j].Amount, new { maxlength = 18, @class = "form-control addamtcls groupOfTexbox decimalOnly setAmount", id = "Amt_" + k, onchange = "AddAmt();" })
                                                        <br />
                                                        @Html.ValidationMessageFor(model => model.ChildAmount)
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-3 col-xs-3 paddingrightzero">
                                                    <a class="btnaddbox" id="aAdd_@k" onclick="AddField(@k)"><i class="fa fa-plus"></i></a>
                                                    <a id="aRemove_@k" class="aremove" onclick="RemoveField(@k)" style="display:none;"><i class="fa fa-minus"></i></a>

                                                </div>
                                            </div>
                                        </div>
                                    }
                                }

                                @{
                                    if (Model.InvoiceTypeId != 2)
                                    {
                                        <div id="divdiscount">
                                            <div class="row form-group">
                                                <div id="divdiscountlabel">
                                                    <div class="col-md-12">
                                                        <label>Discount<span class="highlight"></span> </label>
                                                    </div>
                                                </div>
                                                <div class="col-lg-3 col-md-4 col-sm-3">
                                                    @Html.DropDownList("DiscountTypeId", null, "Select Type", new { @class = "form-control  myval required", @required = "required", id = "discountype", @onchange = "Binddiscount();" })
                                                </div>
                                                <div class="col-lg-1 col-sm-1 dollarpersign" id="divper" style="display:none">%</div>
                                                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 padleftzero padrightzero" id="divpercentage" style="display:none;">
                                                    <div class="form-group marbtmzero">
                                                        @Html.TextBoxFor(model => model.DiscountPercent, new { maxlength = 6, @class = "form-control groupOfTexbox decimalOnly  required", id = "Discount", onchange = "Calculatediscount()", @required = "required" })
                                                        @Html.TextBoxFor(model => model.CheckDup, new { maxlength = 6, @class = "", @style = "display:none;" })
                                                    </div>
                                                </div>
                                                <div class="col-lg-1 col-sm-1 dollarpersign" id="divdolar" style="display:none">$</div>
                                                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-7 padleftzero padrightzero" id="divdiscountamt" style="display:none;">
                                                    <div class="form-group marbtmzero">
                                                        @Html.TextBoxFor(model => model.DiscountAmount, new { maxlength = 18, @class = "form-control groupOfTexbox decimalOnly  required", id = "DiscountAmount", @required = "required", onchange = "Calculatediscount()" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div style="display:none">
                                            @Html.DropDownList("DiscountTypeId", null, "Select Type", new { @class = "form-control  myval required", @required = "required", id = "discountype", @onchange = "Binddiscount();" })
                                        </div>
                                    }
                                }

                                <div class="row form-group" id="SelectDeptForDisc">
                                    <div class="col-lg-7 col-md-6 col-sm-5">
                                        <div class="form-group bg_red">
                                            @Html.DropDownList("Disc_Dept_id", null, "Department", new { @class = "form-control  wdith255 myval ", id = "Disc_Drp_1" })
                                            @Html.ValidationMessageFor(model => model.Disc_Dept_id)
                                        </div>
                                    </div>
                                </div>
                                <div class="row" id="divNoNeedForCRApproval">
                                    <div class="col-md-6 col-sm-6">
                                        <div class="form-group">
                                            <div class="custom-control custom-checkbox">
                                                <input class="chk" id="QuickCRInvoice" type="checkbox" name="QuickCRInvoice" value="1" style="display:none;">
                                                <label for="QuickCRInvoice" style="display:none;">No need for approval credit memo</label>
                                                <input type="hidden" id="QuickCR" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-7 col-md-6 col-sm-6">
                                        <div class="form-group"> <span class="invoiceamttl">Total Invoice Amount</span> </div>
                                    </div>
                                    <div class="col-lg-5 col-md-5 col-sm-5 col-xs-8 padleftzero">
                                        <div class="form-group">
                                            <b><span class="spncredit spncredit2" style="color:white;"> - </span></b><span id="spanamount" class="spanamount " style="padding-left: 0px;">
                                                @Model.TotalAmount
                                            </span>

                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                Note
                            </label><br />
                            @Html.TextAreaFor(model => model.Note, new { maxlength = 100, @class = "form-control addinvoiceareasize addinvoicearea" })
                        </div>

                        @if (Roles.IsUserInRole("Administrator") || Roles.IsUserInRole("ApproveInvoice"))
                        {
                            <div class="row" id="divNoNeedForApproval">
                                <div class="col-md-6 col-sm-6">
                                    <div class="form-group">
                                        @if (Model.StatusValue.ToString() == "Approved")
                                        {
                                            <div class="custom-control custom-checkbox">
                                                <input class="chk" id="QuickInvoice" checked="checked" type="checkbox" name="QuickInvoice" value="1">
                                                <label for="QuickInvoice">No need for approval</label>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="custom-control custom-checkbox">
                                                <input class="chk" id="QuickInvoice" type="checkbox" name="QuickInvoice" value="1">
                                                <label for="QuickInvoice">No need for approval</label>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                        else if (!Roles.IsUserInRole("Administrator") && new SysnthesisRepo.WebRoleProvider().GetroleUserRoleWise(UserModule.getUserTypeId(), "nnfapprovalInvoice", Model.StoreId) == true) /*Roles.IsUserInRole("nnfapprovalInvoice")*/
                        {
                            <div class="row" id="divNoNeedForApproval">
                                <div class="col-md-6 col-sm-6">
                                    <div class="form-group">
                                        <div class="custom-control custom-checkbox">
                                            <input class="chk" id="QuickInvoice" type="checkbox" name="QuickInvoice" value="1">
                                            <label for="QuickInvoice">No need for approval</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        @if (Model.IsSync == 0 || Model.IsSync == null)
                        {
                            <div class="row">
                                <div class="col-md-6 col-sm-6">
                                    <div class="form-group">
                                        <div class="custom-control custom-checkbox">
                                            @if (Model.QBTransfer == true)
                                            {
                                                <input class="chk" id="QBtransfer" type="checkbox" checked="checked" name="QBtransferss" value="1">
                                            }
                                            else
                                            {
                                                <input class="chk" id="QBtransfer" type="checkbox" name="QBtransferss" value="1">
                                            }
                                            <label for="QBtransfer">No QB transfer</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        <div class="from-group row">
                            <div class="col-sm-8 ">
                                <input type="submit" value="Update" class="buttonbox btnsubmit btn_spcial" onclick="return validatedrptext();" id="btnUpdate" />
                                <span id="divCancel"></span>
                            </div>
                        </div>
                    </div>
                    <div id="2" class="hidden">
                        <div class="control-section">
                            @Html.EJS().Grid("InlineEditing").AllowSorting().AllowFiltering().FilterSettings(filter => { filter.Type(Syncfusion.EJ2.Grids.FilterType.CheckBox); }).DataSource(dataManager => { dataManager.Url("/Invoices/UrlDatasource?InvoiceID=" + Model.InvoiceId).Adaptor("UrlAdaptor").InsertUrl("/Invoices/Insert").UpdateUrl("/Invoices/Update").RemoveUrl("/Invoices/Remove"); }).SelectionSettings(sel => { sel.PersistSelection(true); }).Columns(col =>
                                                               {
                                                                   col.Type("checkbox").Width("50").Add();
                                                                   col.Field("InvoiceProductId").IsPrimaryKey(true).HeaderText("Invoice Product Id").Visible(false).Add();
                                                                   col.Field("InvoiceId").HeaderText("Invoice Id").Visible(false).DefaultValue(Model.InvoiceId).Add();
                                                                   col.Field("UPCCode").HeaderText("UPC Code").Width("150").Add();
                                                                   col.Field("Description").HeaderText("Name").Width("250").Add();
                                                                   col.Field("Qty").HeaderText("Qty").EditType("numericedit").Format("n").Width("150").Add();
                                                                   col.Field("UnitPrice").HeaderText("UnitPrice").EditType("numericedit").Format("C2").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Right).Width("150").Add();
                                                                   col.Field("Total").HeaderText("Total").EditType("numericedit").Format("C2").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Right).Width("150").Add();
                                                                   col.Field("Approved").HeaderText("Approved").DisplayAsCheckBox(true).EditType("booleanedit").TextAlign(Syncfusion.EJ2.Grids.TextAlign.Center).Width("150").Add();
                                                               }).AllowPaging().QueryCellInfo("customiseCell").PageSettings(page => { page.PageCount(2).PageSize(30); }).EditSettings(edit => { edit.AllowAdding(true).AllowEditing(true).AllowDeleting(true).ShowDeleteConfirmDialog(true).Mode(Syncfusion.EJ2.Grids.EditMode.Normal); }).Toolbar(new List<string>() { "Add", "Edit", "Delete", "Update", "Cancel", "Search" }).Render()
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="clear">
    </div>
}

<div id="popupDepartment" class="divIDClass modal-popup modal-danger modal-message " style="position: fixed;  left:45%; width:300px; top: 10px; display:none">
    <div class="modal-content ">
        <div class="modal-header text-center">
            <i class="glyphicon glyphicon-fire"></i>
        </div>
        <div class="modal-title">Department</div>
        <div class="modal-body ">Please select Department.</div>
        <div class="modal-footer " style="text-align:center">
            <a class="btn" data-dismiss="modal" onclick="closemodal()">OK</a>
        </div>
    </div>
</div>
<div id="popupidext" class="divIDClass modal-popup modal-danger modal-message " style="position: fixed;  left:45%; width:300px; top: 10px; display:none; z-index:9999999999;">
    <div class="modal-content ">
        <div class="modal-header text-center">
            <i class="glyphicon glyphicon-fire"></i>
        </div>
        <div class="modal-title">PDF</div>
        <div class="modal-body ">Please upload file having extensions .pdf only.</div>
        <div class="modal-footer " style="text-align:center">
            <a class="btn btnredbox" data-dismiss="modal" onclick="closemodal()">OK</a>
        </div>
    </div>
</div>
<div id="popupExists" class="divIDClass modal-popup modal-danger modal-message spical_modal " style="position: fixed;  left:45%; width:300px; top: 10px; display:none">
    <div class="modal-content duplicatedata ">
        <div class="modal-header text-center">
            <button type="button" onclick="closemodal()" class="close">&times;</button>
            <i class="glyphicon glyphicon-fire"></i>
        </div>
        <div class="modal-title">Duplicate found</div>
        <div class="modal-body ">This invoice already exists in the database.</div>
        <div class="modal-footer " style="text-align:center">
            <a data-dismiss="modal" onclick="closemodal()" id="hrefopeninvoice" href="#" target="_blank" class="btn">Open Invoice</a>
            <a href="@Url.Action("IndexBeta", "Invoices")" class="btn" data-dismiss="modal">Cancel</a>
        </div>
    </div>
</div>
<div id="popupSize" class="divIDClass modal-popup modal-danger modal-message " style="position: fixed;  left:45%; width:300px; top: 10px; display:none">
    <div class="modal-content ">
        <div class="modal-header text-center">
            <i class="glyphicon glyphicon-fire"></i>
        </div>
        <div class="modal-title">Invalid PDF Size</div>
        <div class="modal-body ">File Size is too Big.</div>
        <div class="modal-footer " style="text-align:center">
            <a class="btn btnredbox" data-dismiss="modal" onclick="closemodal()">OK</a>
        </div>
    </div>
</div>
<div id="popupcheckExistsagain" class="divIDClass modal-popup modal-danger modal-message spical_modal " style="position: fixed;  left:45%; width:300px; top: 10px; display:none">
    <div class="modal-content duplicatedata">
        <div class="modal-header text-center">
            <button type="button" onclick="SubDuplicatepopupclose()" class="close">&times;</button>
            <i class="glyphicon glyphicon-fire"></i>
        </div>
        <div class="modal-title">Potential Duplicate</div>
        <div class="modal-body ">
            Another invoice already exists with this number.
            <div style="text-align:center" id="divdisplayduplicateinvoice">
            </div>
        </div>
        <div class="modal-footer " style="text-align:center">
            <a dat-dismiss="modal" onclick="DisableKeepandSave();" id="btnPopupKeepandSave" class="btn" data-dismiss="modal">Keep and Save</a>
            <a onclick="SubDuplicatepopupclose()" class="btn" data-dismiss="modal">Cancel</a>

        </div>
    </div>
</div>

<script>
function validatedrptext(myVald) {
    if (myVald == 1) {
        var store =@Session["storeid"];

        if (store == 0) {
            $('#popupStoreid').show();
        }
        else {
            $('#popupStoreid').hide();
        }

        var i = $(".tbladdoncls .trrowcls").length;
        var k = 0;
        var Amount;
        for (var j = 1; j <= i; j++) {
            Amount = $("#Amt_" + j).val();
            if (Amount == "") {
                $("#Amt_" + j).val(0);
                k++
            }
        }
        if (k == i) {
            $('#popupDepartment').show();
            return false;
        }
        else {
            $('#popupDepartment').hide();
        }
    }
    }

    $(document).ready(function () {
        var invdate = new Date($("#InvoiceDate").val());
        var closingdate = new Date('@ViewBag.closingyear', 01 - 1, 01);
        if (invdate < closingdate) {
             if ((@ViewBag.closingyear - 1) == '2023') {
                 $("#btnUpdate").show();
            } else {
                 $("#btnUpdate").hide();
            }
        }
        else {
            $("#btnUpdate").show();
        }

        Getvalues();
        getDepartmentList();
        $('#SelectDeptForDisc').hide();
        $('#frm1').attr('autocomplete', 'off');

        AddAmt();
        $('[data-toggle="tooltip"]').tooltip();
        CheckField();
        var Detailstorenamevalue = '@(ViewBag.Detailstorenamevalue)';

        if (Detailstorenamevalue != "") {
            var role = '@Roles.IsUserInRole("Data Approver")';

            if (role == 'True') {
                $('#drp').val([Detailstorenamevalue]).trigger('change');
            }
            else {
                $('#spnStore').html(Detailstorenamevalue);
            }
        }
        var VendorId = $('#VendorId').val();

        if ($('#Payment_type').val() == "Cash") {
            $('#Type_id').attr("disabled", "disabled");
        }

        if ($('#Type_id').val() == "2") {
            $('.spncredit').show()
            $('.spanamount').show()
            $('.spanamount').addClass("spanamountBackcolor");
        }
        else {
            $('.spncredit').hide();
            $('.spanamount').removeClass("spanamountBackcolor");
            $('.spanamount').show()

        }
        var today = document.getElementById("CurrentDate").value;
        $('#Invoice_Date').datetimepicker({
            format: 'MMM DD,YYYY',
            useCurrent: false,
            maxDate: today,
            minDate: new Date(2021, 01-1, 01),
        });

        @*$('#InvoiceDate').datetimepicker({
            format: 'MMM DD,YYYY',
            useCurrent: true,
            maxDate: today,
            minDate: new Date('@ViewBag.closingyear', 01-1, 01),
        });*@

        if ($("#discountype").val() === "2") {
            $("#divpercentage").show();
            $("#divdiscountamt").show();
            $("#divper").show();
            $("#divdolar").show();
            $('#DiscountAmount').attr('readonly', true);
            $('#SelectDeptForDisc').show();
            if ($("#QuickCR").val() == "1") {
                $("#divNoNeedForCRApproval").show();
            }
            else {
                $("#divNoNeedForCRApproval").hide();
            }
        }
        else if ($("#discountype").val() === "3") {
            $("#divpercentage").hide();
            $('#DiscountAmount').attr('readonly', false);
            $("#divper").hide();
            $("#divdolar").show();
            $("#divdiscountamt").show();
            $('#SelectDeptForDisc').show();
            if ($("#QuickCR").val() == "1") {
                $("#divNoNeedForCRApproval").show();
            }
            else {
                $("#divNoNeedForCRApproval").hide();
            }
        } else {
            $("#divpercentage").hide();
            $("#divdiscountamt").hide();
            $("#divper").hide();
            $("#divdolar").hide();
            $('#DiscountAmount').attr('readonly', false);
            $('#SelectDeptForDisc').hide();
            $("#divNoNeedForCRApproval").hide();
        }
        //ddLTypeChange($("#Type_id").val());
        GetStoreWiseCRApprovalRights();
        getvendortoolkit(VendorId);
    });

function getvendortoolkit(vid) {
        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: '/Invoices/GetVendorToolTip',
            data: { vid: vid, sid:@Model.VendorMasters.StoreId, listid: @Model.VendorMasters.ListId },
            success: function (Data) {

                $("#ToolTipInstuctions").empty();

                var strspn = '';
                var synStatus = Data.QbStatus;
                var QBStatus = "@Model.VendorMasters.IsActive";
                if (synStatus != null && synStatus != "" && QBStatus != null && QBStatus != "") {
                    if (synStatus == "Active" && QBStatus == "True") {
                        $("#spnActive").removeClass("synthesisOnlyActive").addClass("bothActive");
                        strspn = "<span class='bothActive' id='spnActive'></span>";
                    }
                    else {
                        $("#spnActive").removeClass("bothActive").addClass("synthesisOnlyActive");
                        strspn = "<span class='synthesisOnlyActive' id='spnActive'></span>";
                    }
                }
                else {
                    $("#spnActive").removeClass("bothActive").addClass("synthesisOnlyActive");
                    strspn = "<span class='synthesisOnlyActive' id='spnActive'></span>";
                }

                if (Data.Instruction != null && Data.Instruction != "") {
                    $("#ToolTipInstuctions").append("<label>Vendor Name</label><span class='highlight' style='margin-right: auto;'>*</span>" + strspn + "<span class='InvoiceTool'>" + Data.Instruction + "</span>");
                }
                else {
                    $("#ToolTipInstuctions").append("<label>Vendor Name</label><span class='highlight' style='margin-right: auto;'>*</span>" + strspn + "<span class='InvoiceTool'>Instructions</span>");
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {

            }
        });
    }

    $(document).ready(function () {
        var invdate = new Date($("#InvoiceDate").val());
        const d = new Date(invdate);
        let year = d.getFullYear();
        var mindateyear = "";
        if (year == @ViewBag.closingyear - 1) {
            mindateyear = @ViewBag.closingyear - 1;
        }
        else {
            mindateyear = @ViewBag.closingyear;
        }


        $('#InvoiceDate').datetimepicker({
            format: 'MMM DD,YYYY',
            useCurrent: false,
            maxDate: moment(),
            minDate: new Date(mindateyear, 01-1, 01),
        });

    });
</script>
<script src="~/Form_JS/InvoiceEdit.js?version=@System.Configuration.ConfigurationManager.AppSettings["version"].ToString()"></script>

<style>
    .spical_modal .modal-header {
        position: relative;
    }

        .spical_modal .modal-header .close {
            position: relative;
            z-index: 999;
            right: 9px;
            top: 3px;
        }
</style>
@Html.EJS().ScriptManager()



