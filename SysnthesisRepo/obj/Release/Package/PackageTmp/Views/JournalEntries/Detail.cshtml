@model EntityModels.Models.GeneralEntriesDetail
@using Utility
<style>
    .warning {
        padding: 15px 10px 15px 45px;
        background-repeat: no-repeat;
        background-position: 10px center;
        font-family: 'Maven Pro', sans-serif !important;
        color: black;
        background-color: #FFF4E1;
        background-image: url('/Content/Admin/images/warning-orange.svg');
        background-size: 24px 24px;
        margin-left: 30px;
        margin-top: 10px;
    }
    .sticky-header {
        position: sticky;
        top: 79px;
        z-index: 9999;
    }
    #lblclosedate {
        font-size: 17px;
        font-weight: bold;
        padding-top: 2px;
    }
</style>
@using (Html.BeginForm("Detail", "JournalEntries", FormMethod.Post, new { enctype = "multipart/form-data", id = "frmuser" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <div class="page-body headertopbox addinvoice">
        <div class="header-small special_bg marginleft0 box_special1 marginnone  martop15 sticky-header">
            <div class="hd_tital" style="width:auto;">
                <div class="set_two" style="float:left">
                    <span>Journal Entry</span><div class="paddleft10"> <label Id="lblclosedate"></label></div>
                </div>
                @if ((Roles.IsUserInRole("Administrator") || Roles.IsUserInRole("ApproveJournalEntries")) && Model.JournalEntriesLists.FirstOrDefault().QBStatusField == true)
                {
                    <div style="float:right;margin-bottom:5px;" class="warning"><span data-toggle="tooltip" data-placement="bottom">Selected Store QB Token is Suspended</span></div>
                }
            </div>
            <div class="hd_right">
                <div class="addrowbox">
                    <input type="button" class="add-row btn_orange clsbtnedit" value="Edit Values" onclick="Editfunction()">
                    <input type="submit" value="Save Values"
                           class="add-row btn_orange clsbtnsubmit" style="display:none" />
                    <a href="/JournalEntries/JournalEntriesIndex" class="pull-right btnbackbox" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Back"><i class="fa fa-chevron-left" aria-hidden="true"></i> Back</a>
                </div>

            </div>
            <div class="form-group row col-md-12">
                <div class="hd_tital">
                    <div>
                        @if (Model.JournalEntriesLists.Count() > 0)
                        {
                            if (Model.JournalEntriesLists[0].NotConfigureAccount.ToString() != "")
                            {
                                <div class="warning">
                                    <span data-toggle="tooltip" data-placement="bottom" title="@Model.JournalEntriesLists[0].NotConfigureAccount.ToString()">One or more tender account(s) are not configured in settings. </span>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
        <div class="datagrid">
            <div class="table-responsive">
                <table class="table table-striped table-hover table_green_set">
                    <thead>
                        <tr class="bg_green">
                            <th style="text-align:left">QB Account</th>
                            <th width="150" class="brd_right1" style="text-align:center">Debit</th>
                            <th width="150" style="text-align:center">Credit</th>
                            <th style="text-align:left">Memo</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            decimal Debittot = 0;
                            decimal Credittot = 0;

                            if (Model.JournalEntriesLists.Count() > 0)
                            {
                                for (var i = 0; i < Model.JournalEntriesLists.Count(); i++)
                                {
                        <tr>
                            @Html.HiddenFor(model => Model.JournalEntriesLists[i].ChildSalesId)
                            @Html.HiddenFor(model => Model.JournalEntriesLists[i].id)
                            @Html.HiddenFor(model => Model.JournalEntriesLists[i].CloseOutDateformat, new { Id = "HndCloseoutdate" })
                            @Html.HiddenFor(model => Model.JournalEntriesLists[i].StoreID, new { Id = "HndStoreID" })
                            @Html.HiddenFor(model => Model.JournalEntriesLists[i].Sign)

                            <td style="text-align:left">@Model.JournalEntriesLists[i].DeptName</td>
                            <td style="text-align:right">
                                @if (Model.JournalEntriesLists[i].Typeid == 2 || (Model.JournalEntriesLists[i].Sign == 2 && Model.JournalEntriesLists[i].Typeid != 1))
                                            {
                                    <span class="despan"><strong>$ @AdminSiteConfiguration.PriceWithComma(Convert.ToString(Model.JournalEntriesLists[i].TotalAmount))</strong></span>
                                    Debittot = Convert.ToDecimal(Debittot + @Model.JournalEntriesLists[i].TotalAmount);
                                    @Html.TextBoxFor(model => model.JournalEntriesLists[i].TotalAmount, new { maxlength = 500, @class = "form-control txtedit bold decimalOnly", style = "display: none;" })
                                }
                                else
                                { <strong>-</strong>}
                            </td>
                            <td style="text-align:right">
                                @if (Model.JournalEntriesLists[i].Typeid == 1)
                                {
                                    <span class="crspan"><strong>$ @AdminSiteConfiguration.PriceWithComma(Convert.ToString(Model.JournalEntriesLists[i].TotalAmount))</strong></span>
                                    Credittot = Convert.ToDecimal(Credittot + @Model.JournalEntriesLists[i].TotalAmount);
                                    @Html.TextBoxFor(model => model.JournalEntriesLists[i].TotalAmount, new { maxlength = 500, @class = "form-control txtedit bold decimalOnly", style = "display: none;" })
                                }
                                else
                                { <strong>-</strong>}
                            </td>
                            <td style="text-align:left">@Model.JournalEntriesLists[i].Memo</td>
                        </tr>
                                }
                                <tr class="last-tr">

                                    <td>&nbsp;</td>
                                    <td class="fnt20 brd_right3 clsgrey" style="text-align:right;">
                                        <span Id="Iddebtot">
                                            <input type="hidden" id="hnddebitvalue" value="@Debittot" />
                                            <strong>$ @AdminSiteConfiguration.PriceWithComma(Convert.ToString(@Debittot)) </strong><br />
                                        </span>
                                    </td>
                                    <td class="fnt20 clsgrey2" style="text-align:right">
                                        <input type="hidden" id="hndcreditvalue" value="@Credittot" />
                                        <span Id="Idcredtot">
                                            <strong> $ @AdminSiteConfiguration.PriceWithComma(Convert.ToString(@Credittot)) </strong>
                                        </span>
                                    </td>
                                    <td style="text-align:right">
                                        <div Id="DivApprove">
                                            @if (Roles.IsUserInRole("Administrator") || Roles.IsUserInRole("ApproveJournalEntries"))
                                            {
                                                if (Model.JournalEntriesLists[0].Status == "Pending")
                                                {
                                                    <a onclick="ConfirmApprove(@Model.JournalEntriesLists[0].id,'@Model.JournalEntriesLists[0].Status')" class="btn_comman buttonbox btnsubmit" title="Mark As Approve">Approve</a>
                                                }
                                                else
                                                {
                                                    <a onclick="ConfirmApprove(@Model.JournalEntriesLists[0].id,'@Model.JournalEntriesLists[0].Status')" class="btn_comman buttonbox btnsubmit" title="Mark As Approve">Approve</a>
                                                }
                                            }
                                        </div>
                                        <div Id="DivDesableApprove" style="Display:none">
                                            <label class="btn_comman buttonbox btnsubmit btn_red float_left" id="lbl" style="Display:none">Total Debit and Credit Amount don't match.</label>
                                            <a href="#" class="btn_comman buttonbox btnsubmit btn_gray isDisabled">Approve</a>
                                        </div>
                                    </td>
                                </tr>
                            }
                            else
                            {
                            }
                        }

                    </tbody>
                </table>
                <div id="popupApproveAlert" class="divIDClass modal-popup modal-danger modal-message" style="position: fixed;  left:45%; width:300px; top: 30%; display:none">
                    <div class="modal-content ">
                        <div class="modal-header text-center">
                            <i class="glyphicon glyphicon-fire"></i>
                        </div>
                        <div class="modal-title"><b><label id="DisplayStatus"></label></b><input type="hidden" id="DisplayIdNumber" /></div>
                        <div class="modal-body "></div>
                        <div class="modal-footer " style="text-align:center">
                            <a class="btn btn-success" onclick="MarkAsApprove()">Yes </a>
                            <a class="btn btn-danger" data-dismiss="modal" onclick="closemodal()">No </a>
                        </div>
                    </div>
                </div>
                <div id="popupConfiguration" class="divIDClass modal-popup modal-danger modal-message " style="position: fixed;  left:45%; width:300px; top: 30%; display:none">
                    <div class="modal-content ">
                        <div class="modal-header text-center">
                            <i class="glyphicon glyphicon-fire"></i>
                        </div>
                        <div class="modal-title"><b><label id="DisplayStatus">Please Configure Group Names.</label></b><input type="hidden" id="DisplayIdNumber" /></div>
                        <div class="modal-body "></div>
                        <div class="modal-footer " style="text-align:center">
                            <a class="btn btn-danger" data-dismiss="modal" onclick="closemodal()">ok </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<script>
    var SureApprove = '@ViewBag.SureApprove';
    var AlreadyUpdated = '@ViewBag.AlreadyUpdated';
    var Approve = '@ViewBag.Approve';
    var ReApprove = '@ViewBag.ReApprove';
</script>

<script src="~/Form_JS/JournalEntries.js"></script>