@*@model IEnumerable<EntityModels.Models.DailyPosFeeds>*@
@*@using Utility*@
@using Syncfusion.EJ2
@using Newtonsoft.Json
@{

    Layout = null;
}

<link href="~/Content/ej2/bootstrap5.css" rel="stylesheet" />
<link href="~/Content/Admin/assets/css/style_new.css" rel="stylesheet" />

<div class="loading-containers loading-inactives" style="display:none;">
    <div class="loaders"></div>
</div>

@Html.EJS().Toast("toast_type").NewestOnTop(true).ShowCloseButton(true).Position(p => p.X("Right")).TimeOut(5000).Render()

<div class="page-body headertopbox" style="padding-top:0px!important;">
    <div class="control-section">
        <div id="customDialog"></div>
        @{
            string storeid = (Session["storeid"] == null ? "0" : Session["storeid"].ToString());
        }
        @Html.EJS().Grid("DailyPosFeedsGrid").AllowSorting().AllowFiltering().AllowPdfExport().AllowExcelExport().FilterSettings(filter => { filter.Type(Syncfusion.EJ2.Grids.FilterType.CheckBox); }).Created("created").EnableStickyHeader(true).AllowTextWrap().Columns(col =>
   {
       col.Field("SalesActivitySummaryId").IsPrimaryKey(true).HeaderText("SalesActivitySummaryId").Visible(false).Add();
       //col.HeaderText("Transaction Time").Width("30%").Template("<span>${dpsformatDate(TransactionStartTime)} - ${dpsformatDate(TransactionEndTime)}</span>").Add();
       col.HeaderText("Transaction Time").Width("30%")
               .Template(@"
                    <a href='/Terminal/Index?StoreId=${StoreId}&TerminalId=${StoreTerminalId}&StartDate=${dpsformatDateterminal(TransactionStartTime)}&shiftid=${ShiftId}'
                       data-toggle='tooltip' data-placement='top' data-original-title='' style='color: #385585;'>
                        ${dpsformatDate(TransactionStartTime)} - ${dpsformatDate(TransactionEndTime)}
                    </a>
                ").Add();
       if (storeid == "0" || storeid == null)
       {
           col.Field("StoreName").HeaderText("Store Name").Width("10%").Add();
       }
       col.Field("TerminalName").HeaderText("Terminal").Width("10%").Add();
       col.Field("ShiftName").HeaderText("Shift").Width("10%").Add();
       col.Field("CustomerCount").HeaderText("Customer Count").AllowFiltering(false).Width("10%").Add();
       col.Field("NetSalesWithTax").HeaderText("Net Sales With Tax").AllowFiltering(false).Template("#NetSaleAmountTemplate").Width("10%").Add();
       col.Field("TotalTaxCollected").HeaderText("Total Tax Collected").AllowFiltering(false).Template("#TotalTaxAmountTemplate").Width("10%").Add();
       col.Field("AverageSale").HeaderText("Average Sale").Width("10%").AllowFiltering(false).Template("#AverageAmountTemplate").Add();
       col.HeaderText("Action").Width("10%").Template("#EditTemplate").Add();
   }).DataBound("dataBound").AllowPaging().PageSettings(page => { page.PageCount(2).PageSize(50); }).Toolbar(new List<string>() { "Search" }).Render()
    </div>
</div>

<script type="text/x-jsrender" id="EditTemplate">
    <div style="display: flex; gap: 5px; align-items: center;">
        <a detail="Recent Entry Edit FilePath - ${FileName}" href="/Report/DownloadFile?filePath=${FileName}" data-toggle="tooltip" data-placement="top" data-original-title="Download" target="_blank">
            <img src="/Content/Admin/images/1pdf-files.png" alt="Download" />
        </a>
        <a detail="Recent Entry Details - ${SalesActivitySummaryId}" href="/Report/PDFFileDetail?id=${SalesActivitySummaryId}" data-toggle="tooltip" data-placement="top" data-original-title="Details" target="_blank">
            <img src="/Content/Admin/images/file-text.svg" alt="Details" />
        </a>
        <a detail="Recent Entry Delete SalesActivitySummaryId - ${SalesActivitySummaryId}" href="javascript:ComfirmDeleteej2(${SalesActivitySummaryId});" data-toggle="tooltip" data-placement="top" data-original-title="Delete">
            <img src="/Content/Admin/images/trash-2.svg" alt="" />
        </a>
    </div>


    <div id="${SalesActivitySummaryId}" class="divIDClass modal-popup modal-danger modal-message " style="position: fixed;  left:45%; width:300px; top: 10px; display:none">
        <div class="modal-content ">
            <div class="modal-header text-center">
                <i class="glyphicon glyphicon-trash"></i>
            </div>
            <div class="modal-title">Message</div>
            <div class="modal-body"><p id="deleModalbody"> Are you sure you want to delete this Entry?</p></div>
            <div class="modal-footer" style="text-align:center">
                <a class="btn btn-danger" detail="Recent Entry Delete Confirm -" href="javascript:Deleteej2(${SalesActivitySummaryId});">Ok </a>
                <a class="btn" data-dismiss="modal" detail="Recent Entry Delete Confirm -" onclick="closemodal()">Cancel</a>
            </div>
        </div>
    </div>
</script>
<script>
    function dpsformatDate(date) {
        const options = {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: true
        };
        return new Date(date).toLocaleString('en-US', options);
    }

    function dpsformatDateterminal(date) {
        const options = {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
        };
        return new Date(date).toLocaleDateString('en-US', options);
    }
</script>
<script type="text/x-jsrender" id="NetSaleAmountTemplate">
    <td>
        ${formatCurrency(NetSalesWithTax)}
    </td>
</script>
<script type="text/x-jsrender" id="TotalTaxAmountTemplate">
    <td>
        ${formatCurrency(TotalTaxCollected)}
    </td>
</script>
<script type="text/x-jsrender" id="AverageAmountTemplate">
    <td>
        ${formatCurrency(AverageSale)}
    </td>
</script>
<script>
    function formatCurrency(value) {
        return '$ ' + parseFloat(value).toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }
</script>
<script>
    var scrollVal = 0;
</script>
<script src="~/Form_JS/DailyPosFeedsGrid.js"></script>
@Html.EJS().ScriptManager()