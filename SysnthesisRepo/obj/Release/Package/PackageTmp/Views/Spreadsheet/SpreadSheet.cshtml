@using Syncfusion.EJ2
@using Utility
@{
    ViewBag.Title = "SpreadSheet";
    Layout = "~/Views/Shared/AdminMaster.cshtml";
}
<style>
    .toast-top-right {
        top: 80px;
        right: 40% !important;
    }
    .modal-backdrop {
        z-index: 0 !important;
    }
</style>
<link href="~/Content/ej2/bootstrap5.css" rel="stylesheet" />
<link href="~/Content/DocumentBar.css" rel="stylesheet" />
<div id="grddata">
    <div class="newdocumentuploadpage">
        <div class="page-body headertopbox addinvoice" style="padding-top:0px!important;">
            <div class="control-section">
                @*@Html.EJS().DropDownButton("element").Content("Save").Items((IEnumerable<object>)ViewBag.items).Select("itemSelect").Render()*@
                @*@Html.EJS().Button("element").Content("Save").Click("itemSelect").Render()*@
                <div class="excelBar">
                    <img src="~/Content/image/excel.svg" />
                    <span class="documentName" id="DocumentName">@ViewBag.AttachFile</span>
                    <div class="buttonsContainer">
                        <a data-toggle="modal" data-target="#EditModel" style="text-decoration: none;"><img src="~/Content/image/edit.svg" />Edit</a>
                        <a class="saveButton" onclick="itemSelect()"><img src="~/Content/image/save.svg" />Save</a>
                        @*<a style="text-decoration: none;" onclick="PrintItem();"><img src="~/Content/image/print.svg" />Print</a>*@
                        <a class="downloadButton" onclick="saveFile();"><img src="~/Content/image/download.svg" />Download</a>
                    </div>
                </div>
                @Html.EJS().Spreadsheet("spreadsheet").Render()

            </div>
        </div>
    </div>

</div>
<div class="modal fade" id="EditModel" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content" style="margin-top:14%">
            <div class="modal-header text-center">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit Document</h4>
            </div>
            <div class="modal-body">
                <div id="frmUserType" class="form-horizontal">
                    @{ Html.RenderAction("EditDocumentsDetali", new { ids = ViewBag.id }); }
                </div>
            </div>
            <div class="modal-footer modal-delete-footer">
                <input form="UpLedger" type="button" class="buttonbox btnsubmit" value="Add" onclick="EditDocument();" />
                <button type="button" class="buttonbox btncancel" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script>
    // Triggers once the control is loaded
    //function created() {
    //    var spreadsheet = ej.base.getComponent(document.getElementById('spreadsheet'), 'spreadsheet');
    //    fetch("https://js.syncfusion.com/demos/ejservices/data/Spreadsheet/LargeData.xlsx") // fetch the remote url
    //        .then((response) => {
    //            response.blob().then((fileBlob) => { // convert the excel file to blob
    //                var file = new File([fileBlob], "Sample.xlsx"); //convert the blob into file
    //                spreadsheet.open({ file: file }); // open the file into Spreadsheet
    //            })
    //        })
    //}
    //document.addEventListener("DOMContentLoaded", function () {
    //    
    //    var spreadsheetObj = ej.base.getComponent(document.getElementById('spreadsheet'), 'spreadsheet');
    //    if (spreadsheetObj.documentName === '') {
    //        spreadsheetObj.documentName = 'Untitled';
    //    }
    //    var documentTitleContentEditor = document.getElementById('DocumentName');
    //    documentTitleContentEditor.textContent = spreadsheetObj.documentName;
        
    //});
    window.onload = function () {
        $('#HeaderStoreId').prop('disabled', true);
        var spreadsheetObj = ej.base.getComponent(document.getElementById('spreadsheet'), 'spreadsheet');
        fetch('/SpreadSheet/LoadExcel',
            {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ FileName: "@ViewBag.FileName", FilePath : "@ViewBag.AttachLink"}),
            })
            .then((response) => response.json())
            .then((data) => {
                console.log(data);
                spreadsheetObj.openFromJson({ file: data });
            })

        setTimeout(function () {
            $("#spreadsheet > .file-input-wrapper").addClass("hidden");
        }, 1000);
    }

    @*function created() {
        var spreadsheet = ej.base.getComponent(document.getElementById('spreadsheet'), 'spreadsheet');
        fetch("@ViewBag.AttachLink") // fetch the remote url
            .then((response) => {
                response.blob().then((fileBlob) => { // convert the excel file to blob
                    var file = new File([fileBlob], "@ViewBag.FileName"); //convert the blob into file
                    spreadsheet.open({ file: file }); // open the file into Spreadsheet
                })
            })


    }*@
    $(document).ready(function () {
        $("#spreadsheet_sheet_panel").css("height", "750px")
        var message = '@ViewBag.Message';
        if (message != '') {
            if (message == "0") {
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "3000",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "10000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
                toastr.success('Successfully Saved Excel File.');
            }
            else {
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "3000",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "10000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }

                toastr.error('Excel File Save Failed.');
            }
        }


    });

    function itemSelect() {

        var spreadsheetObj = ej.base.getComponent(document.getElementById('spreadsheet'), 'spreadsheet');

            spreadsheetObj.save({ url: '@AdminSiteConfiguration.GetURL()Spreadsheet/save', fileName: "@ViewBag.AttachFile", saveType: "Xlsx" });
        @*if (args.item.text === 'Save As xls')
            spreadsheetObj.save({ url: 'https://ej2services.syncfusion.com/production/web-services/api/spreadsheet/save', fileName: "@ViewBag.AttachFile", saveType: "Xls" });
        if (args.item.text === 'Save As csv')
            spreadsheetObj.save({ url: 'https://ej2services.syncfusion.com/production/web-services/api/spreadsheet/save', fileName: "@ViewBag.AttachFile", saveType: "Csv" });
        if (args.item.text === 'Save As pdf')
            spreadsheetObj.save({ url: 'https://ej2services.syncfusion.com/production/web-services/api/spreadsheet/save', fileName: "@ViewBag.AttachFile", saveType: "Pdf" });*@
    }

    function saveFile() {
        
        var spreadsheetObj = ej.base.getComponent(document.getElementById('spreadsheet'), 'spreadsheet');
        spreadsheetObj.save({ url: '@AdminSiteConfiguration.GetURL()Spreadsheet/SaveFile', fileName: "@ViewBag.AttachFile", saveType: "Xlsx" });
    }

    function EditDocument() {
        
        var DocumentId = $('#DocumentId').val();
        var DocumentCategoryId = $('#DocumentCategoryId').val();
        var KeyWords = $('#KeyWords').val();
        var Notes = $('#Notes').val();
        var chkFav = $('#chkFav').val();
        var Title = $('#Title').val();
        $.ajax({
            url: '/SpreadSheet/EditDocumentsDetaliValue',
            type: "post",
            cache: false,
            data: { DocumentId: DocumentId, DocumentCategoryId: DocumentCategoryId, KeyWords: KeyWords, Notes: Notes, chkFav: chkFav, Title: Title },
            success: function (states) {
                //$('#DocumentId').val("");
                //$('#KeyWords').val("");
                //$('#Notes').val("");
                //$('select#DocumentCategoryId').val("");
                //$('#chkFav').attr('checked', false); // Unchecks it

                if (states == "Completed") {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "3000",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "10000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }
                    toastr.success('Successfully Edit Document Data.');
                    $('#EditModel').modal('hide');
                }
                else {
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "3000",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "10000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }

                    toastr.error('Something went to wrong');
                }
            }
        });
    }
    //var printElement = ej.base.createElement("div",
    //    {
    //    className: "e-sheet-panel",
    //    innerHTML:'<div class="e-spreadsheet-print"></div><div class="e-sheet"><div class="e-main-panel style="height:100%" style="overflow: unset"><div class="e-sheet-content" ></div></div></div>'
    //    }
    //); // creating same hierarchy of element as DOM
    //var isPrint = false;


    //function PrintItem() {
    //    
    //    var spreadsheetObj = ej.base.getComponent(document.getElementById('spreadsheet'), 'spreadsheet');
    //    var sheets = spreadsheetObj.sheets;
    //    if (spreadsheetObj.activeSheetIndex === 0) {
    //        printElement.querySelector(".e-sheet-content").innerHTML = document.querySelector(
    //            ".e-sheet-content"
    //        ).outerHTML; //  To add the spreadsheet table

    //        var usedRange = spreadsheetObj.getActiveSheet().usedRange;
    //        var tbody = printElement.querySelector('tbody');
    //        for (var i = tbody.getElementsByClassName('e-row').length; i >= 0; i--) {
    //            if (tbody.getElementsByClassName('e-row')[i] && parseInt(tbody.getElementsByClassName('e-row')[i].getAttribute('aria-rowindex')) > usedRange.rowIndex + 1) {
    //                tbody.getElementsByClassName('e-row')[i].remove();
    //            }
    //        }

    //        if (sheets[spreadsheetObj.activeSheetIndex + 1]) {
    //            spreadsheetObj.goTo(sheets[spreadsheetObj.activeSheetIndex + 1].name + "!A1");
    //            isPrint = true;
    //        } else {
    //            print(printElement);
    //            printElement.querySelector(".e-sheet-content").innerHTML = '';
    //        }
    //    } else {
    //        if (sheets[0]) {
    //            spreadsheetObj.goTo(sheets[0].name + "!A1");
    //            isPrint = true;
    //        }
    //    }
    //}

</script>
@Html.EJS().ScriptManager()
