@using Syncfusion.EJ2
@using Newtonsoft.Json
<link href="~/Content/ej2/bootstrap5.css" rel="stylesheet" />
<link href="~/Content/Admin/assets/css/style_new.css" rel="stylesheet" />
<style>
    .je-date {
        display: flex;
        width: 252px;
        margin: 0 0 0 auto;
    }
    #txtstartdate{width:165px;}
    .e-grid .e-gridheader .e-sortfilter .e-fltr-icon[aria-colindex="5"] .e-headercelldiv {
        margin: -5px 20px -5px 0px;
    }
        .e-grid .e-gridheader .e-sortfilter .e-fltr-icon[aria-colindex="6"] .e-headercelldiv {
        margin: -5px 20px -5px 18px;
    }
    .e-grid .e-gridheader .e-sortfilter .e-fltr-icon[aria-colindex="7"] .e-headercelldiv {
        margin: -5px 20px -5px 8px;
    }
    .e-grid .e-gridheader .e-sortfilter .e-headercell[aria-colindex="3"] .e-headercelldiv {
        margin: -5px 20px -5px 8px;
    }
    
</style>

<div class="loading-containers loading-inactives" style="display:none;">
    <div class="loaders"></div>
</div>
<div class="header-small special_bg" style="margin: 0px;position:sticky;top:78px;z-index:99">
    <div class="row">
        <div class="col-md-6">
            <h3>Journal Entries</h3>
        </div>
@*        <div class="col-md-3">
        </div>*@
        <div class="col-md-6">
            <div class="je-date">
                <input name="txtstartdate" type="text" maxlength="100" id="txtstartdate" placeholder="From" class="datepicker form-control" onkeydown="return false">
                <input type="submit" name="btnSearch" value="Search" id="btnSearch" onclick="JournalSearchRecord();" class=".searchfinal .btnsearchicon marginleft10" />
            </div>
        </div>
    </div>
</div>

@Html.EJS().Toast("toast_type").NewestOnTop(true).ShowCloseButton(true).Position(p => p.X("Right")).TimeOut(5000).Render()


<div id="grddata">
    <div class="page-body headertopbox" style="padding-top:0px!important;">
        <div class="control-section">
            <div id="customDialog"></div>
            @Html.EJS().Grid("JournalEntriesGrid").AllowSorting().AllowFiltering().AllowPdfExport().AllowExcelExport().FilterSettings(filter => { filter.Type(Syncfusion.EJ2.Grids.FilterType.CheckBox); }).Created("created").EnableStickyHeader(true).AllowTextWrap().Columns(col =>
       {
           col.Field("SalesGeneralId").IsPrimaryKey(true).HeaderText("SalesGeneralId").Visible(false).Add();
           //col.Field("IsSync").Visible(false).Add();
           col.Field("SalesDate").Visible(false).Add();
           col.HeaderText("Date").Width("20%").Template("#SaleDateTemplate").Add();
           if ((int)ViewBag.Storeidvalue == 0)
           {
               col.Field("StoreName").HeaderText("Store").Width("10%").Add();
           }
           col.Field("NoOfPos").HeaderText("No# of Pos").Width("10%").Add();
           col.Field("TotalAmount").HeaderText("Total Amount").Width("10%").Template("#TotalAmountTemplate").Add();
           col.Field("IsSync").HeaderText("Status").Width("10%").Template("#SyncTemplate").Filter(new { type = "CheckBox", itemTemplate = "#JournalEntryStatus" }).Add();
           col.HeaderText("QB Status").Width("10%").Template("#QBTemplate").Add();
           col.HeaderText("Action").Width("10%").Template("#EditTemplate").Add();
       }).DataBound("dataBound").AllowPaging().PageSettings(page => { page.PageCount(2).PageSize(500); }).Toolbar(new List<string>() { "Search" }).Render()
        </div>
    </div>
</div>
<script type="text/x-jsrender" id="EditTemplate">
    <a detail="Recent Entry Delete SalesGeneralId - ${SalesGeneralId}" href="javascript:ComfirmDeleteej2(${SalesGeneralId});" data-toggle="tooltip" data-placement="top" data-original-title="Delete"><img src="/Content/Admin/images/icon-trash.svg" alt="" /> </a>
    <a detail="Recent Entry Edit SalesGeneralId - ${SalesGeneralId}" href="/JournalEntries/Detail/${SalesGeneralId}" data-toggle="tooltip" data-placement="top" data-original-title="Edit" target="_blank"><img src="/Content/Admin/images/icon-edit.svg" alt="" /></a>

    <div id="${SalesGeneralId}" class="divIDClass modal-popup modal-danger modal-message " style="position: fixed;  left:45%; width:300px; top: 10px; display:none">
        <div class="modal-content ">
            <div class="modal-header text-center">
                <i class="glyphicon glyphicon-trash"></i>
            </div>
            <div class="modal-title">Message</div>
            <div class="modal-body"><p id="deleModalbody"> Are you sure you want to delete this Entry?</p></div>
            <div class="modal-footer" style="text-align:center">
                <a class="btn btn-danger" detail="Recent Entry Delete Confirm -" href="javascript:Deleteej2(${SalesGeneralId});">Ok </a>
                <a class="btn" data-dismiss="modal" detail="Recent Entry Delete Confirm -" onclick="closemodal()">Cancel</a>
            </div>
        </div>
    </div>
</script>
<script type="text/x-jsrender" id="SyncTemplate">
    <div id="status" class="statustemp">
        <td>
            ${if(IsSync == "1")}
            <span class="btn btn-success btn-xs clsstatus"><i class="fa fa-check"></i> Approved</span>
            ${else}
            <span class="btn btn-warning btn-xs btnpending clsstatus" style="width:80px;"><i class="fa fa-minus" aria-hidden="true"></i> Pending</span>
            ${/if}
        </td>
    </div>
</script>
<script type="text/x-jsrender" id="QBTemplate">
    <div id="statuss" class="statustemps">
        <td>
            ${if(IsSync == "1")}
            <img src="/QBImages/synced.png" style="height: 100%;" />
            ${else}
            <img src="/QBImages/not-synced.png" style="height: 100%;width:75px;" />
            ${/if}
        </td>
    </div>
</script>
<script type="text/x-jsrender" id="SaleDateTemplate">
    <div id="statuss" class="statustemps">
        <td>
            <a detail="Recent Entry Edit SalesGeneralId - ${SalesGeneralId}" href="/JournalEntries/Detail/${SalesGeneralId}" data-toggle="tooltip" data-placement="top" data-original-title="Edit" target="_blank" style="color: #385585;">${SaleformatDate(SalesDate)}</a>
        </td>
    </div>
</script>
<script>
        function SaleformatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            const formattedDate = date.toLocaleDateString('en-US', options);

            const [month, day, year] = formattedDate.split(' ');
            return `${month} ${day.replace(',', '')}, ${year}`;
        }
</script>
<script type="text/x-jsrender" id="TotalAmountTemplate">
    <td>
        ${formatCurrency(TotalAmount)}
    </td>
</script>
<script>
    function formatCurrency(value) {
        return '$ ' + parseFloat(value).toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }
</script>
<script>
    $(document).ready(function () {
        $("#txtstartdate").autocomplete(false);

        $('#txtstartdate').datetimepicker({
            format: 'MMM-YYYY',
            useCurrent: false,
            daysOfWeekDisabled: [0, 6]

        });

        var startDateInput = $("#txtstartdate").val().trim();
        if (!startDateInput) {
            var now = new Date();
            var currentMonth = now.toLocaleString('en-US', { month: 'short' });
            var currentYear = now.getFullYear();
            var formattedDate = `${currentMonth}-${currentYear}`;
            $("#txtstartdate").val(formattedDate);
        }
    });
</script>
<script type="text/x-jsrender" id="JournalEntryStatus">
    ${JournalEntryStatusDetails(data)}
</script>
<script>
    var scrollVal = 0;
</script>
<script src="~/Form_JS/JournalEntries.js"></script>
@Html.EJS().ScriptManager()